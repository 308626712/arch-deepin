# Maintainer: Josip Ponjavic <josipponjavic at gmail dot com>

pkgname=deepin-notifications
pkgver=20140508~fc6d8b7
pkgrel=1
pkgdesc="System notifications for linuxdeepin desktop environment."
arch=('i686' 'x86_64')
url="https://gitcafe.com/Deepin/deepin-notifications"
license=('GPL3')
depends=('glib2' 'python2')
makedepends=('go>=1.3' 'go-dlib' 'dde-go-dbus-factory')
groups=('deepin')
options=(staticlibs)
source=("${pkgname}-${pkgver}.tar.xz")
sha256sums=('SKIP')

prepare() {
  cd "${pkgname}-${pkgver}"

  # fix python version
  find -iname "*.py" | xargs sed -i 's=\(^#! */usr/bin.*\)python *$=\1python2='
}

build() {
  cd "${pkgname}-${pkgver}"/src

  GOPATH=`pwd` go build && mv src ${pkgname}
}

package() {
  cd "${pkgname}-${pkgver}"/src

  install -dm 755 "${pkgdir}"/usr/share/{dbus-1/services,deepin-notifications}
  install -m 755 ${pkgname} "${pkgdir}"/usr/share/${pkgname}/
  cp -r {*.py,ui} "${pkgdir}"/usr/share/${pkgname}/
  install -m 644 org.freedesktop.Notifications.service "${pkgdir}"/usr/share/dbus-1/services/
}
