# Maintainer: Josip Ponjavic <josipponjavic at gmail dot com>

pkgname=dde-control-center
pkgver=git20140526~951e4cc
pkgrel=1
pkgdesc="New control center for linux deepin"
arch=('i686' 'x86_64')
url="https://gitcafe.com/Deepin/dde-control-center"
license=('GPL3')
depends=('dde-daemon' 'deepin-qml-widgets' 'dde-qml-dbus-factory' 'dde-qml-gettext-plugin'
    'qml-dde-dock-applet' 'deepin-artwork-themes' 'dde-account-faces'
	'qt5-declarative' 'qt5-graphicaleffects' 'qt5-tools' 'qt5-quickcontrols' 'qt5-svg')
makedepends=('gettext')
groups=('deepin')
options=(staticlibs)
#install=${pkgbase}.install
source=("${pkgname}-${pkgver}.tar.xz")
sha256sums=('SKIP')

prepare() {
  cd "${pkgname}-${pkgver}"

  # fix python version
  find -iname "*.py" | xargs sed -i 's=\(^#! */usr/bin.*\)python=\1python2='
}

build(){
  cd "${pkgname}-${pkgver}"

  cd dock-applets && qmake && make && cd ..
  cd qt5frame && qmake && make && cd ..
  cd locale && sh ../debian/generate_mo.sh
}

package() {
  cd "${pkgname}-${pkgver}"

  cd dock-applets && make INSTALL_ROOT="${pkgdir}/" install && cd ..
  cd qt5frame && make INSTALL_ROOT="${pkgdir}/" install && cd ..

  #install -dm 755 "${pkgdir}"/usr/{bin,share/dde-control-center}
  #cp -R {frame,locale,modules} "${pkgdir}"/usr/share/${pkgname}/
  install -dm 755 "${pkgdir}"/{etc/xdg/autostart,usr/share/{applications,dbus-1/services}}
  install -m 644 dde-dock-applets-autostart.desktop "${pkgdir}"/etc/xdg/autostart/
  install -m 644 ${pkgname}.desktop "${pkgdir}"/usr/share/applications/
  install -m 644 *.service "${pkgdir}"/usr/share/dbus-1/services/

  #ln -s /usr/share/${pkgname}/frame/main.py "${pkgdir}"/usr/bin/${pkgname}
}
