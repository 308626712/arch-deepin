# Maintainer: Josip Ponjavic <josipponjavic at gmail dot com>
# Maintainer: Xu Fasheng <fasheng.xu[AT]gmail.com>

pkgname=dde-daemon
pkgver=2.92.2
_commit=dea2892ac333755f88e481e7bb43742e5b8c0c83
pkgrel=1
pkgdesc='daemon handling the DDE session settings'
arch=('i686' 'x86_64')
url="https://github.com/linuxdeepin/dde-daemon"
license=('GPL3')
depends=('deepin-desktop-schemas' 'gvfs'
		 'libcanberra-pulse' 'metacity' 'poppler-glib' 'rfkill')
makedepends=('dde-api' 'go-packages' 'gtk2' 'python2' 'sqlite3' 'startdde')
optdepends=('networkmanager: Network Management daemon'
			'grub-theme-deepin: deepin theme for grub menu')
groups=('deepin')
install="${pkgname}.install"
# source=("git+https://github.com/linuxdeepin/dde-daemon.git#commit=$_commit"
#         'fix-i686-compile.patch')
source=("dde-daemon.tar.xz"
        'fix-i686-compile.patch')
sha256sums=('SKIP'
            '7b147d9ab9c29dcfa73906aa743d03aae7bed317553e42c604d3c1bf539ba1bc')

prepare() {
	cd dde-daemon
	# TODO: a temporary solution by disable go-sqlite3 to avoid build
	#       issue for go1.4/i686
    # https://github.com/golang/go/issues/9510
	[[ $CARCH == "i686" ]] && patch -p1 -i ../fix-i686-compile.patch
}

build() {
	cd dde-daemon
	make GOPATH="/usr/lib/go"
}

package() {
	depends+=('acpid' 'bluez' 'deepin-notifications' 'iso-codes' 'lsb-release'
			  'mobile-broadband-provider-info' 'polkit-gnome'
			  'udisks2' 'upower' 'xcur2png')
	cd dde-daemon
	make GOPATH="/usr/lib/go" DESTDIR="${pkgdir}" install
}
