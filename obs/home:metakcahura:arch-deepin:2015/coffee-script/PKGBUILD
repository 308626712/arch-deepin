# Maintainer: Josip Ponjavic <josipponjavic at gmail dot com>
# Maintainer: Xu Fasheng <fasheng.xu[AT]gmail.com>

pkgname=coffee-script
pkgver=1.6.3.188.g1f301d8
pkgrel=1
pkgdesc='CoffeeScript is a little language that compiles into JavaScript.'
arch=('any')
url='http://coffeescript.org'
license=('custom')
depends=('nodejs' 'nodejs-mkdirp' 'underscorejs')
source=("${pkgname}-${pkgver}.tar.xz")
md5sums=('SKIP')

check() {
	export NODE_PATH=/usr/share/underscorejs:$NODE_PATH
	cd $pkgname-$pkgver
	bin/cake test:browser
}

package() {
	cd "${pkgname}-${pkgver}"

	install -d $pkgdir/usr/lib/node_modules
	bin/cake --prefix "$pkgdir/usr/" install
	cp -r $pkgdir/usr/lib/coffee-script $pkgdir/usr/lib/node_modules/
	rm -rf $pkgdir/usr/lib/coffee-script
	install -Dm644 LICENSE "$pkgdir/usr/share/licenses/${pkgname}/LICENSE"
	#install -Dm644 README "$pkgdir/usr/share/doc/${pkgname}/README"
	rm -rf $pkgdir/usr/bin/cake $pkgdir/usr/bin/coffee
	ln -sf /usr/lib/node_modules/coffee-script/bin/{cake,coffee} "$pkgdir/usr/bin/"
}
