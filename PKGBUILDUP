###* variables
# PKGBUILDUP_LOG="./pkgbuildup_result.log"
# INTEGRITY_CHECK="md5"
# IGNORE_WARN="t"
# DOWNLOAD_OVERWRITE="false"
UPLOAD_CMD="burp -kv %s"

deepin_pkgsite="http://packages.linuxdeepin.com"
# deepin_pkgsite="http://mirrors.ustc.edu.cn" # candidate server
tplname="PKGBUILD.tpl"

###* functions

# variable $tplfile, $pkgverreg, $pkgrelreg, $makepkg and $upload will
# be used, besides, if $FILE_INFO is empty, $pkgname, $url and $filereg
# will be used
update_pkgbuild_for_deepin() {
    abort_if_var_empty "${pkgname}" "pkgname"
    local pkgname=${pkgname}
    msg "Package name: ${pkgname}"

    # build default $FILE_INFO which own one file
    if [ -z "${FILE_INFO}" ]; then
        local url=${url:-"${deepin_pkgsite}/deepin/pool/main/d/${pkgname}"}
        local filereg=${filereg:-"${pkgname}_.*?\.tar.gz"}
        local FILE_INFO=("fileurl::md5::${url}::${filereg}")
    fi

    local tplfile=${tplfile:-"./${pkgname}/${tplname}"}
    local pkgverreg=${pkgverreg:-"git[^_.-]*"}
    local pkgrelreg=${pkgrelreg:-""} # ignore this argument

    # local makepkg=${makepkg:-"true"}
    # local upload=${upload:-"true"}

    # local makepkg="false"
    local makepkg="true"
    local upload="false"
    # local upload="true"

    update_pkgbuild_for_source_site "${tplfile}" "${pkgverreg}" "${pkgrelreg}" "${makepkg}" "${upload}"
}

update_local_git() {
    git add -u .
    git commit -m "Update by pkgbuild_update"
}

###** deepin-artwork
update_deepin_artwork() {
    local pkgname="deepin-artwork"
    local pkgverreg="\d{2}\.\d{2}\.\d{2}"
    update_pkgbuild_for_deepin
}

###** deepin-cursor-theme
update_deepin_cursor_theme() {
    local pkgname="deepin-cursor-theme"
    local pkgverreg="[0-9]{2}[^_-]*"
    update_pkgbuild_for_deepin
}

###** deepin-desktop-environment
update_deepin_desktop_environment() {
    local pkgname="deepin-desktop-environment"
    update_pkgbuild_for_deepin
}

###** deepin-desktop-environment-plugins
update_deepin_desktop_environment_plugins() {
    local pkgname="deepin-desktop-environment-plugins"
    local pkgrelreg="\d+\.\d+\.[^+]*"
    update_pkgbuild_for_deepin
}

###** deepin-media-player
update_deepin_media_player() {
    local pkgname="deepin-media-player"
    update_pkgbuild_for_deepin
}

###** deepin-music-player
update_deepin_music_player() {
    local pkgname="deepin-music-player"
    update_pkgbuild_for_deepin
}

###** deepin-notifications
update_deepin_notifications() {
    local pkgname="deepin-notifications"
    update_pkgbuild_for_deepin
}

###** TODO deepin-pygkt-fix

###** deepin-screenshot
update_deepin_screenshot() {
    local pkgname="deepin-screenshot"
    update_pkgbuild_for_deepin
}

###** deepin-system-tray
update_deepin_system_tray() {
    local pkgname="deepin-system-tray"
    update_pkgbuild_for_deepin
}

###** deepin-terminal
update_deepin_terminal() {
    local pkgname="deepin-terminal"
    update_pkgbuild_for_deepin
}

###** deepin-ui
update_deepin_ui() {
    local pkgname="deepin-ui"
    local filereg="${pkgname}_.*?\.tar\.gz"
    update_pkgbuild_for_deepin
}

###** TODO deepin-vte-plus

###** deepin-wallpapers
update_deepin_wallpapers() {
    local pkgname="deepin-wallpapers"
    local pkgrelreg="\d+\.\d+"
    update_pkgbuild_for_deepin
}

###** deepin-webapps
update_deepin_webapps() {
    local pkgname="deepin-webapps"
    local tplfile="./${pkgname}/${tplname}"
    local url="${deepin_pkgsite}/deepin/pool/main/d/${pkgname}"

    # build $FILE_INFO
    local webapps="kuwo-music dbank-online-storage youdao-note chainrxn \
                   doit-im microsoft-skydrive baidu-map douban ttpod \
                   kugou-music kingsoft-fast-docs xiami-music cargo-bridge \
                   sina-weibo pirateslovedaisies kingsoft-online-storage \
                   baidu-music baidu-online-storage paulrouget towerim \
                   fetion baidu-hi 12306"
    local i=1;
    for app in ${webapps}; do
        local FILE_INFO["$(expr ${i}-1)"]="fileurl_${i}::md5_${i}::${url}::${pkgname}-${app}_.*?_all\.deb"
        ((i++))
    done

    local pkgverreg="[0-9]+\.[0-9]+[^-_]*"
    update_pkgbuild_for_deepin
}

###* main
# update_deepin_artwork
# update_deepin_cursor_theme
# update_deepin_desktop_environment
# update_deepin_desktop_environment_plugins
# update_deepin_media_player
update_deepin_music_player
# update_deepin_notifications
# update_deepin_screenshot
# update_deepin_system_settings
# update_deepin_system_tray
# update_deepin_terminal
# update_deepin_ui
# update_deepin_wallpapers
# update_deepin_webapps

# update_local_git

# Local Variables:
# mode: sh
# mode: orgstruct
# End:
